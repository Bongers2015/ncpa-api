{
	"basePath": "/api/tnm/v1",
	"consumes": [
		"application/json"
	],
	"definitions": {
		"Card": {
			"properties": {
				"token": {
					"type": "string",
					"description": "RFID"
				},
				"status": {
					"type": "string",
					"enum": [
						"ACCEPTED",
						"BLOCKED",
						"EXPIRED",
						"INVALID",
						"UNKNOWN"
					]
				},
				"expirationDate": {
					"type": "string",
					"x-nullable": true
				}
			},
			"required": [
				"token",
				"status"
			],
			"type": "object",
			"additionalProperties": false
		},
		"CardRegistration": {
			"properties": {
				"card": {
					"$ref": "#/definitions/Card",
					"x-nullable": true
				},
				"status": {
					"type": "string",
					"enum": [
						"SUCCESS",
						"FAILURE",
						"TIMEOUT"
					]
				},
				"statusMessage": {
					"type": "string"
				}
			},
			"required": [
				"status",
				"statusMessage"
			],
			"type": "object",
			"additionalProperties": false
		},
		"Status": {
			"properties": {
				"chargePointStatus": {
					"type": "string",
					"enum": [
						"OPERATIVE",
						"INOPERATIVE",
						"FAULTED"
					]
				},
				"transactionStatus": {
					"items": {
						"type": "string",
						"enum": [
							"AVAILABLE",
							"PREPARING",
							"CHARGING",
							"SUSPENDED_EV",
							"SUSPENDED_EVSE",
							"FINISHING",
							"FAULTED"
						]
					},
					"type": "array"
				},
				"connectorStatus": {
					"items": {
						"type": "string",
						"enum": [
							"OPERATIVE",
							"INOPERATIVE",
							"FAULTED"
						]
					},
					"type": "array"
				},
				"authorizationMode": {
					"type": "string",
					"enum": [
						"PLUGNCHARGE",
						"WHITELIST"
					]
				},
				"numberOfRFIDCardsRegistered": {
					"type": "integer",
					"format": "int64"
				}
			},
			"required": [
				"chargePointStatus",
				"transactionStatus",
				"connectorStatus",
				"authorizationMode",
				"numberOfRFIDCardsRegistered"
			],
			"type": "object",
			"additionalProperties": false
		},
		"Transaction": {
			"properties": {
				"id": {
					"type": "string"
				},
				"remoteId": {
					"type": "string",
					"x-nullable": true
				},
				"token": {
					"type": "string",
					"description": "card token id"
				},
				"startDate": {
					"type": "integer",
					"format": "int64"
				},
				"stopDate": {
					"type": "integer",
					"format": "int64",
					"x-nullable": true
				},
				"stopReason": {
					"type": "string",
					"x-nullable": true
				},
				"startWattHour": {
					"type": "integer",
					"format": "int64"
				},
				"stopWattHour": {
					"type": "integer",
					"format": "int64",
					"x-nullable": true
				},
				"consumedWattHours": {
					"type": "integer",
					"format": "int64"
				}
			},
			"required": [
				"id",
				"token",
				"startDate",
				"startWattHour",
				"consumedWattHours"
			],
			"type": "object",
			"additionalProperties": false
		},
		"Upgrade": {
			"properties": {
				"originalname": {
					"type": "string",
					"description": "Name of the file on the user's computer"
				},
				"encoding": {
					"type": "string",
					"description": "Encoding type of the file"
				},
				"mimetype": {
					"type": "string",
					"description": "Mime type of the file"
				},
				"size": {
					"type": "number",
					"format": "double"
				},
				"destination": {
					"type": "string",
					"description": "The folder to which the file has been saved (DiskStorage)"
				},
				"location": {
					"type": "string",
					"description": "The url where to get the uploaded file (aws S3 for example)"
				},
				"filename": {
					"type": "string",
					"description": "The name of the file within the destination (DiskStorage)"
				},
				"path": {
					"type": "string",
					"description": "Location of the uploaded file (DiskStorage)"
				}
			},
			"required": [
				"originalname",
				"encoding",
				"mimetype",
				"size",
				"destination",
				"location",
				"filename",
				"path"
			],
			"type": "object",
			"additionalProperties": false
		},
		"CreateCardRequest": {
			"properties": {
				"token": {
					"type": "string"
				}
			},
			"required": [
				"token"
			],
			"type": "object",
			"additionalProperties": false
		},
		"GetAuthQrResponse": {
			"properties": {
				"host": {
					"type": "string",
					"description": "{protocol}://{host}:{port}/{path}"
				},
				"qrDataUrl": {
					"type": "string",
					"description": "QR bitmap encoded as data url"
				},
				"requestUrl": {
					"type": "string",
					"description": "authorization request url"
				},
				"tokenCipher": {
					"type": "string",
					"description": "url encoded encrypted jwt token"
				}
			},
			"required": [
				"host",
				"qrDataUrl",
				"requestUrl",
				"tokenCipher"
			],
			"type": "object",
			"additionalProperties": false
		}
	},
	"info": {
		"title": "ncpa-api",
		"version": "1.0.0",
		"description": "Reference API for NCPA",
		"license": {
			"name": "UNLICENSED"
		}
	},
	"paths": {
		"/auth": {
			"get": {
				"operationId": "ValidateAuthToken",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"type": "string"
						}
					}
				},
				"description": "expects token as url encoded cyphered jwt token like so:\n```json\n{\n\"iss\": \"TNM Auth server\",\n\"sub\": \"{cp-uuid}\",\n\"aud\": \"operator\" | \"installer\",\n\"iat\": {unix time}},\n\"wifi\": {\n\"ssid\": \"my-ssid\",\n\"password\": \"strong-wifi-password\",\n\"type\": \"wpa2\",\n\"hidden\": true\n}\n```\nreturns an access token:\n\n```json\n{\n\"iss\": \"{cp-uuid}\",\n\"sub\": \"{cp-uuid}\",\n\"aud\": \"{client-uuid}\",\n\"iat\": 1516239022,\n\"scopes\": [\"operator\" | \"installer\"]\n}\n```",
				"tags": [
					"operator"
				],
				"security": [],
				"parameters": [
					{
						"in": "query",
						"name": "token",
						"required": true,
						"type": "string"
					},
					{
						"in": "query",
						"name": "clientId",
						"required": false,
						"type": "string"
					}
				]
			}
		},
		"/authentication-mode": {
			"get": {
				"operationId": "GetAuthenticationMode",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"type": "string",
							"enum": [
								"PLUGNCHARGE",
								"WHITELIST"
							]
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": []
			},
			"post": {
				"operationId": "SetAuthenticationMode",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"type": "string",
							"enum": [
								"PLUGNCHARGE",
								"WHITELIST"
							]
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "query",
						"name": "authenticationMode",
						"required": true,
						"type": "string",
						"enum": [
							"PLUGNCHARGE",
							"WHITELIST"
						]
					}
				]
			}
		},
		"/config/socket-lock-mode": {
			"get": {
				"operationId": "GetSocketLockMode",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"type": "string",
							"enum": [
								"TRANSACTION",
								"LOCKED",
								"UNLOCKED"
							]
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": []
			},
			"post": {
				"operationId": "SetSocketLockMode",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"type": "string",
							"enum": [
								"TRANSACTION",
								"LOCKED",
								"UNLOCKED"
							]
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "query",
						"name": "socketLockMode",
						"required": true,
						"type": "string",
						"enum": [
							"TRANSACTION",
							"LOCKED",
							"UNLOCKED"
						]
					}
				]
			}
		},
		"/whitelist/cards": {
			"get": {
				"operationId": "GetCards",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"items": {
								"$ref": "#/definitions/Card"
							},
							"type": "array"
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": []
			}
		},
		"/whitelist/cards/{token}": {
			"get": {
				"operationId": "GetCard",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"$ref": "#/definitions/Card"
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "path",
						"name": "token",
						"required": true,
						"type": "string"
					}
				]
			},
			"delete": {
				"operationId": "DeleteCard",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"$ref": "#/definitions/Card"
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "path",
						"name": "token",
						"required": true,
						"type": "string"
					}
				]
			}
		},
		"/whitelist/card": {
			"get": {
				"operationId": "RegisterCard",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"$ref": "#/definitions/CardRegistration"
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": []
			}
		},
		"/status": {
			"get": {
				"operationId": "GetChargePointStatus",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"$ref": "#/definitions/Status"
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": []
			}
		},
		"/charging/start": {
			"post": {
				"operationId": "StartCharging",
				"produces": [
					"application/json"
				],
				"responses": {
					"204": {
						"description": "No content"
					}
				},
				"description": "jwt scopes: `operator` `",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "query",
						"name": "clientId",
						"required": true,
						"type": "string"
					}
				]
			}
		},
		"/charging/stop": {
			"post": {
				"operationId": "StopCharging",
				"produces": [
					"application/json"
				],
				"responses": {
					"204": {
						"description": "No content"
					}
				},
				"description": "jwt scopes: `operator`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "query",
						"name": "clientId",
						"required": true,
						"type": "string"
					}
				]
			}
		},
		"/charging/unlock": {
			"post": {
				"operationId": "Unlock",
				"produces": [
					"application/json"
				],
				"responses": {
					"204": {
						"description": "No content"
					}
				},
				"description": "jwt scopes: `operator`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": []
			}
		},
		"/transactions": {
			"get": {
				"operationId": "GetTransactions",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"items": {
								"$ref": "#/definitions/Transaction"
							},
							"type": "array"
						}
					}
				},
				"description": "jwt scopes: `operator`, `installer`",
				"tags": [
					"operator"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": []
			}
		},
		"/upgrade": {
			"post": {
				"operationId": "Upgrade",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"$ref": "#/definitions/Upgrade"
						}
					}
				},
				"description": "jwt scopes: `installer`",
				"tags": [
					"installer"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "formData",
						"name": "data",
						"required": true,
						"type": "file"
					}
				],
				"consumes": [
					"multipart/form-data"
				]
			}
		},
		"/development/whitelist/cards": {
			"post": {
				"operationId": "AddCard",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Ok",
						"schema": {
							"type": "boolean"
						}
					}
				},
				"description": "jwt scopes: `developer`\n\nDeveloper endpoint for whitelisting card manually",
				"tags": [
					"developer"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "body",
						"name": "createCardRequest",
						"required": true,
						"schema": {
							"$ref": "#/definitions/CreateCardRequest"
						}
					}
				]
			}
		},
		"/development/card/registration-response": {
			"post": {
				"operationId": "UpdateCardRegistrationResponse",
				"produces": [
					"application/json"
				],
				"responses": {
					"204": {
						"description": "No content"
					}
				},
				"description": "jwt scopes: `developer`\n\nSet the response of the `/card` endpoint request",
				"tags": [
					"developer"
				],
				"security": [
					{
						"jwtAuth": []
					}
				],
				"parameters": [
					{
						"in": "body",
						"name": "cardRegistrationResponse",
						"required": true,
						"schema": {
							"$ref": "#/definitions/CardRegistration"
						}
					}
				]
			}
		},
		"/development/qr/{host}": {
			"get": {
				"operationId": "GetAuthQr",
				"produces": [
					"application/json"
				],
				"responses": {
					"200": {
						"description": "Returns GetAuthQrResponse",
						"schema": {
							"$ref": "#/definitions/GetAuthQrResponse"
						},
						"examples": {
							"application/json": {
								"host": "https://localhost:3000/api/tnm/freeapp/v1",
								"requestUrl": "https://localhost:3000/api/tnm/freeapp/v1/auth?token=U2FsdGVkX19UjqHxvsfJ%2BSvaean7RNS40GIBGdRGsNOT%2BW7lMzLKoz1A%2BPNumYC%2Fr6wXOyXRgz2p1P0CWSwH0p2NOXywE%2FcxRAbqnt0oLUf8KC5PL1%2FlBWjPwUwYNqvFJUTK82bbXO2Vf9VFzaUw12oUT1eTPoPgcuOcFzF8x%2FdptaCB1AtPp5uDd6LAqFRG51QlIwRDtxahDK95Fj%2FdC9ccnX1Rf3WQeleoBqvrbstWSzZpFiQRk%2BzWzbA36RWRtwiKj%2B%2BJlBUcPDrPIgeifkjL6tBKvdFW1KB0dTqicty%2BUC12BI50FeBtbK1e%2FTofzq%2FOT0FGBGnVk3F0w82wtYtgbtW%2F3kJoGqiuIfHH02%2BA2AwR%2BSgYzME12%2FX0DLVX5i58K3nB13TI5jNYoV6TqQvTeiP6irqukMqpyWcCP1FeXTD72SQvtRqEbNwjTfKSAgCoF%2B%2BA0g%2F800mLGjSBOk5jcZLxsn3PyALzHDVkEaQxShj3wLH1uQcBX630caSH%2Fm6WNQd4X8a2cY06QQk65JJ8ky7BtFq9BaLKmxjVRle%2FHBZlc4ipi3gYv2iczhLvzXxkBUNH6R%2F1%2FWIc9GUhOHPWMtmQE7QmHI0KQq%2B%2FeQRTVMjoA4Va6d91b4epGszQViKdyRInT47a8cRHMqJSBC%2FJ2wMOURluRy%2BXSQMPsfwncOPie2swMMWLrfPSEtAKmYs4asTdu%2FusX9v9FryyztmGosnAZzgL7wgUjrGVIOjvX3DN33%2F4KIE4Tl5C3JrdfdLf4ZhlGTo0ElDdP%2BUsCx%2B1eoytP54Nj%2BOHs8ccTR0%3D",
								"qrDataUrl": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAHUCAYAAACDJ9lsAAAbZElEQVR4AezBQY4cupLAQLLQ978yx8tcCRBUbb8/yAj7g7XWWms9+bDWWmutZx/WWmut9ezDWmuttZ59WGuttdazD2uttdZ69mGttdZazz6stdZa69mHtdZaaz37sNZaa61nH9Zaa6317MNaa621nn1Ya6211rMPa6211nr2Ya211lrPPqy11lrr2Q+PVP6mihsqJxUnKlPFpHKj4obKVDGp3Kg4UTmpOFGZKiaVqWJSmSomlaniN6l8U8WkMlVMKlPFicpUMancqJhUpooTlaniROVFxaQyVdxQmSpuqEwVL1ReVEwqJxU3VKaKE5WpYlL5mypefFhrrbXWsw9rrbXWevZhrbXWWs9++LKKb1K5oTJVnKhMFVPFjYobKlPFicqNihOVqeKGylTxmyomlRcVJxWTylQxqUwVk8qJyouKk4oTlZOKSWWqOFGZKqaKE5Wp4qRiUvkmlaliqphUpopJZar4JpUXKlPFVDGpTBUvKr5J5Zs+rLXWWuvZh7XWWms9+7DWWmutZz/8MpUbFTdUvknlpGKquKEyVbyouKEyVdxQOVE5qbihMlVMFTdUbqicqNyouKEyqUwVk8pUMal8U8WkMlVMKicqU8WJyouKGypTxYnKicqLit+kcqIyVZyofJPKjYrf9GGttdZazz6stdZa69mHtdZaaz374f+ZihOVGxUnKjcqblR8U8WkclIxVUwqU8Wk8k0qLypuVJyoTBUvVE4qJpX/MpWp4m+qmFQmlaliUjlROamYVG6oTBWTylRxovKi4kTlRsX/Jx/WWmut9ezDWmuttZ59WGuttdazH9aRyknFDZWp4obKScWkMlXcUHlR8TdVTConKlPFpDJVTBU3VF6o3FB5oXKj4kTlpOKk4kRlUrmh8k0qJxWTyonKVHGj4kRlqjhRmSomlROVqeJ/2Ye11lprPfuw1lprrWcf1lprrfXsh19W8Tep3KiYVL5J5X9JxQ2VE5WpYlL5JpUTlROVqeJE5aTiRsUNlZOKSWWqeKEyqZxU/E0VJypTxQ2VqeKGyknFicqNikllqnihMlVMKlPFi4r/kg9rrbXWevZhrbXWWs8+rLXWWuvZD1...",
								"tokenCipher": "U2FsdGVkX19UjqHxvsfJ%2BSvaean7RNS40GIBGdRGsNOT%2BW7lMzLKoz1A%2BPNumYC%2Fr6wXOyXRgz2p1P0CWSwH0p2NOXywE%2FcxRAbqnt0oLUf8KC5PL1%2FlBWjPwUwYNqvFJUTK82bbXO2Vf9VFzaUw12oUT1eTPoPgcuOcFzF8x%2FdptaCB1AtPp5uDd6LAqFRG51QlIwRDtxahDK95Fj%2FdC9ccnX1Rf3WQeleoBqvrbstWSzZpFiQRk%2BzWzbA36RWRtwiKj%2B%2BJlBUcPDrPIgeifkjL6tBKvdFW1KB0dTqicty%2BUC12BI50FeBtbK1e%2FTofzq%2FOT0FGBGnVk3F0w82wtYtgbtW%2F3kJoGqiuIfHH02%2BA2AwR%2BSgYzME12%2FX0DLVX5i58K3nB13TI5jNYoV6TqQvTeiP6irqukMqpyWcCP1FeXTD72SQvtRqEbNwjTfKSAgCoF%2B%2BA0g%2F800mLGjSBOk5jcZLxsn3PyALzHDVkEaQxShj3wLH1uQcBX630caSH%2Fm6WNQd4X8a2cY06QQk65JJ8ky7BtFq9BaLKmxjVRle%2FHBZlc4ipi3gYv2iczhLvzXxkBUNH6R%2F1%2FWIc9GUhOHPWMtmQE7QmHI0KQq%2B%2FeQRTVMjoA4Va6d91b4epGszQViKdyRInT47a8cRHMqJSBC%2FJ2wMOURluRy%2BXSQMPsfwncOPie2swMMWLrfPSEtAKmYs4asTdu%2FusX9v9FryyztmGosnAZzgL7wgUjrGVIOjvX3DN33%2F4KIE4Tl5C3JrdfdLf4ZhlGTo0ElDdP%2BUsCx%2B1eoytP54Nj%2BOHs8ccTR0%3D"
							}
						}
					}
				},
				"description": "jwt scopes: `developer` \n\nCreates a QR code containing an identity token\n\n\n```\n{\n\"iss\": \"TNM Auth server\",\n\"sub\": \"{cp-uuid}\",\n\"aud\": \"operator\" | \"installer\",\n\"iat\": 1516239022,\n\"wifi\": {\n\"ssid\": \"my-ssid\",\n\"password\": \"strong-wifi-password\",\n\"type\": \"wpa2\",\n\"hidden\": true\n}\n}\n```",
				"tags": [
					"developer"
				],
				"security": [],
				"parameters": [
					{
						"in": "path",
						"name": "host",
						"required": true,
						"type": "string"
					},
					{
						"description": "valid chargePointId for this application would be `12345`",
						"in": "query",
						"name": "chargePointId",
						"required": true,
						"type": "string"
					},
					{
						"in": "query",
						"name": "clientId",
						"required": true,
						"type": "string"
					},
					{
						"in": "query",
						"name": "scope",
						"required": true,
						"type": "string",
						"enum": [
							"operator",
							"installer"
						]
					}
				]
			}
		}
	},
	"produces": [
		"application/json"
	],
	"swagger": "2.0",
	"securityDefinitions": {
		"api_key": {
			"type": "apiKey",
			"name": "access_token",
			"in": "query"
		},
		"jwtAuth": {
			"type": "apiKey",
			"in": "header",
			"name": "authorization"
		}
	}
}